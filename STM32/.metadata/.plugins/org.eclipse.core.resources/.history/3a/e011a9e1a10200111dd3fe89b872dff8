

/*
 * STM32F401xx.h
 *
 *  Created on: Jan 28, 2026
 *      Author: user
 */

#ifndef INC_STM32F401XX_H_
#define INC_STM32F401XX_H_
#include <stdio.h>
#include <stdint.h>



#define _vol                           volatile



//Memory base address
#define FLASH_BASEADDR                  0x08000000U
#define ROM_BASEADDR                    0x1FFF0000U
#define SRAM1_BASEADDR                  0x20000000U

//Peripheral based bus address

#define APB1_BUSBASEADDR                0x40000000U
#define APB2_BUSBASEADDR                0x40010000U
#define AHB1_BUSBASEADDR                0x40020000U
#define AHB2_BUSBASEADDR                0x50000000U

//Peripheral in AHB1 bus
#define GPIOA_PBASEADDR                (AHB1_BUSBASEADDR + 0X0000)
#define GPIOB_PBASEADDR                (AHB1_BUSBASEADDR + 0X0400)
#define GPIOC_PBASEADDR                (AHB1_BUSBASEADDR + 0X0800)
#define GPIOD_PBASEADDR                (AHB1_BUSBASEADDR + 0X0C00)
#define GPIOE_PBASEADDR                (AHB1_BUSBASEADDR + 0X1000)
#define GPIOH_PBASEADDR                (AHB1_BUSBASEADDR + 0X1C00)

#define CRC_PBASEADDR                  (AHB1_BUSBASEADDR + 0X3000)
#define RCC_PBASEADDR                  0x4002 3BFF
#define FLASH_INTF_REG_PBASEADDR       (AHB1_BUSBASEADDR + 0X3C00)
#define DMA1_PBASEADDR                 (AHB1_BUSBASEADDR + 0X6000)
#define DM2_PBASEADDR                  (AHB1_BUSBASEADDR + 0X6400)

//Peripheral in AHB2 bus
#define USB_OTG_FS_PBASEADDR             AHB2_BUSBASEADDR

//peripheral in APB1 BUS
#define TIM2_PBASEADDR                 (APB1_BUSBASEADDR + 0X0000)
#define TIM3_PBASEADDR                 (APB1_BUSBASEADDR + 0X0400)
#define TIM4_PBASEADDR                 (APB1_BUSBASEADDR + 0X0800)
#define TIM5_PBASEADDR                 (APB1_BUSBASEADDR + 0X0C00)
#define RTC_BKP_REG_PBASEADDR          (APB1_BUSBASEADDR + 0X2800)
#define WWDG_PBASEADDR                 (APB1_BUSBASEADDR + 0X2C00)
#define IWDG_PBASEADDR                 (APB1_BUSBASEADDR + 0X3000)
#define I2S2ext_PBASEADDR              (APB1_BUSBASEADDR + 0X3400)
#define SPI2_I2S2_PBASEADDR            (APB1_BUSBASEADDR + 0X3800)
#define SPI3_I2S2_PBASEADDR            (APB1_BUSBASEADDR + 0X3C00)
#define I2S3ext_PBASEADDR              (APB1_BUSBASEADDR + 0X4000)
#define UART2_PBASEADDR                (APB1_BUSBASEADDR + 0X4400)
#define I2C1_PBASEADDR                 (APB1_BUSBASEADDR + 0X5400)
#define I2C2_PBASEADDR                 (APB1_BUSBASEADDR + 0X5800)
#define I2C3_PBASEADDR                 (APB1_BUSBASEADDR + 0X5C00)

 //Peripheral in APB2 Bus
#define TIM1_PBASEADDR                 (APB2_BUSBASEADDR + 0X0000)
#define USART1_PBASEADDR               (APB2_BUSBASEADDR + 0X1000)
#define USART6_PBASEADDR               (APB2_BUSBASEADDR + 0X1400)
#define ADC1_PBASEADDR                 (APB2_BUSBASEADDR + 0X2000)
#define SDIO_PBASEADDR                 (APB2_BUSBASEADDR + 0X2C00)
#define SPI1_PBASEADDR                 (APB2_BUSBASEADDR + 0X3000)
#define SPI4_PBASEADDR                 (APB2_BUSBASEADDR + 0X3400)
#define SYSCFG_PBASEADDR               (APB2_BUSBASEADDR + 0X3800)
#define EXTI_PBASEADDR                 (APB2_BUSBASEADDR + 0X3C00)
#define TIM9_PBASEADDR                 (APB2_BUSBASEADDR + 0X4000)
#define TIM10_PBASEADDR                (APB2_BUSBASEADDR + 0X4400)
#define TIM11_PBASEADDR                (APB2_BUSBASEADDR + 0X4800)

// GPIO Register definition
typedef struct{
_vol uint32_t MODER;
_vol uint32_t OTYPER;
_vol uint32_t OSPEEDR;
_vol uint32_t PUPDR;
_vol uint32_t  IDR;
_vol uint32_t  ODR;
_vol uint32_t BSRR;
_vol uint32_t LCKR;
_vol uint32_t AFRL;
_vol uint32_t AFRH;

}GPIO_REGDEF_t;

//I2C Register definition
typedef struct{
_vol uint32_t CR1;
_vol uint32_t CR2;
_vol uint32_t OAR1;
_vol uint32_t OAR2;
_vol uint32_t  DR;
_vol uint32_t  SR1;
_vol uint32_t SR2;
_vol uint32_t CCR;
_vol uint32_t TRISE;
_vol uint32_t FLTR;

}I2C_REGDEF_t;

 //USART Register Definition
typedef struct{
_vol uint32_t SR;
_vol uint32_t DR;
_vol uint32_t BRR;
_vol uint32_t CR1;
_vol uint32_t CR2;
_vol uint32_t CR3;
_vol uint32_t GTPR;

}USART_REGDEF_t;

//SPI Register definition
typedef struct{
_vol uint32_t CR1;
_vol uint32_t SR;
_vol uint32_t DR;
_vol uint32_t CRCPR;
_vol uint32_t RXCRCR;
_vol uint32_t TXCRCR;
_vol uint32_t I2SCFGR;
_vol uint32_t I2SPR;


}SPI_REGDEF_t;

//Pointer GPIO
#define GPIOA          (GPIO_REGDEF_t *)( GPIOA_PBASEADDR)     //To access, example: GPIO->IDR
#define GPIOB          (GPIO_REGDEF_t *)( GPIOB_PBASEADDR)
#define GPIOC          (GPIO_REGDEF_t *)( GPIOC_PBASEADDR)
#define GPIOD          (GPIO_REGDEF_t *)( GPIOD_PBASEADDR)
#define GPIOE          (GPIO_REGDEF_t *)( GPIOE_PBASEADDR)
#define GPIOH          (GPIO_REGDEF_t *)( GPIOH_PBASEADDR)

//Pointer I2C
#define I2C1           (I2C_REGDEF_t *)( I2C1_PBASEADDR)
#define I2C2           (I2C_REGDEF_t *)( I2C2_PBASEADDR)
#define I2C3           (I2C_REGDEF_t *)( I2C3_PBASEADDR)

//Pointer USART
#define USART1         (USART_REGDEF_t *)(USART1_PBASEADDR)
#define USART2         (USART_REGDEF_t *)(USART2_PBASEADDR)
#define USART6         (USART_REGDEF_t *)(USART6_PBASEADDR)

//Pointer SPI
#define SPI1           (SPI_REGDEF_t *)(SPI1_PBASEADDR)
#define SPI2_I2S2      (SPI_REGDEF_t *)(SPI2_I2S2_PBASEADDR)
#define SPI3_I2S2      (SPI_REGDEF_t *)(SPI3_I2S2_PBASEADDR)
#define SPI4           (SPI_REGDEF_t *)(SPI4_PBASEADDR)

//RCC register  definition
typedef struct
{
  _vol uint32_t CR;            // 0x00: Clock control register (HSI, HSE, PLL enable/ready flags)
  _vol uint32_t PLLCFGR;       // 0x04: PLL configuration register (PLLM, PLLN, PLLP, PLLQ, PLL source)
  _vol uint32_t CFGR;          // 0x08: Clock configuration register (system clock switch, prescalers, MCO outputs)
  _vol uint32_t CIR;           // 0x0C: Clock interrupt register (flags and enables for clock ready interrupts)
  _vol uint32_t AHB1RSTR;      // 0x10: AHB1 peripheral reset register (reset GPIOs, DMA, CRC)
  _vol uint32_t AHB2RSTR;      // 0x14: AHB2 peripheral reset register (reset USB OTG FS)
  uint32_t RESERVED0;          // 0x18: Reserved
  uint32_t RESERVED1;          // 0x1C: Reserved
  _vol uint32_t APB1RSTR;      // 0x20: APB1 peripheral reset register (reset TIM2–TIM5, SPI2/3, USART2, I2C1–3, PWR)
  _vol uint32_t APB2RSTR;      // 0x24: APB2 peripheral reset register (reset TIM1, TIM9–11, USART1/6, ADC1, SPI1/4, SYSCFG)
  uint32_t RESERVED2;          // 0x28: Reserved
  uint32_t RESERVED3;          // 0x2C: Reserved
  _vol uint32_t AHB1ENR;       // 0x30: AHB1 peripheral clock enable register (enable GPIOs, DMA, CRC)
  _vol uint32_t AHB2ENR;       // 0x34: AHB2 peripheral clock enable register (enable USB OTG FS)
  uint32_t RESERVED4;          // 0x38: Reserved
  uint32_t RESERVED5;          // 0x3C: Reserved
  _vol uint32_t APB1ENR;       // 0x40: APB1 peripheral clock enable register (enable TIM2–TIM5, SPI2/3, USART2, I2C1–3, PWR)
  _vol uint32_t APB2ENR;       // 0x44: APB2 peripheral clock enable register (enable TIM1, TIM9–11, USART1/6, ADC1, SPI1/4, SYSCFG)
  uint32_t RESERVED6;          // 0x48: Reserved
  uint32_t RESERVED7;          // 0x4C: Reserved
  _vol uint32_t AHB1LPENR;     // 0x50: AHB1 peripheral clock enable in low-power mode
  _vol uint32_t AHB2LPENR;     // 0x54: AHB2 peripheral clock enable in low-power mode
  uint32_t RESERVED8;          // 0x58: Reserved
  uint32_t RESERVED9;          // 0x5C: Reserved
  _vol uint32_t APB1LPENR;     // 0x60: APB1 peripheral clock enable in low-power mode
  _vol uint32_t APB2LPENR;     // 0x64: APB2 peripheral clock enable in low-power mode
  uint32_t RESERVED10;         // 0x68: Reserved
  uint32_t RESERVED11;         // 0x6C: Reserved
  _vol uint32_t BDCR;          // 0x70: Backup domain control register (RTC clock source, LSE enable/bypass, backup reset)
  _vol uint32_t CSR;           // 0x74: Clock control & status register (LSI enable/ready, reset flags)
  uint32_t RESERVED12;         // 0x78: Reserved
  uint32_t RESERVED13;         // 0x7C: Reserved
  _vol uint32_t SSCGR;         // 0x80: Spread spectrum clock generation register (modulation for EMI reduction)
  _vol uint32_t PLLI2SCFGR;    // 0x84: PLLI2S configuration register (used for I2S audio clock generation)
  uint32_t RESERVED14;         // 0x88: Reserved
  _vol uint32_t DCKCFGR;       // 0x8C: Dedicated clock configuration register (I2S, SAI, timers prescaler)

} RCC_REGDEF_t;

#define RCC            (RCC_REGDEF_t *)(RCC_PBASEADDR)

//Peripheral Clock enable and Disable macros
#define GPIOA_PCLK_EN()        (RCC->AHB1ENR|=(1<<0))
#define GPIOB_PCLK_EN()        (RCC->AHB1ENR|=(1<<1))
#define GPIOC_PCLK_EN()        (RCC->AHB1ENR|=(1<<2))
#define GPIOD_PCLK_EN()        (RCC->AHB1ENR|=(1<<3))
#define GPIOE_PCLK_EN()        (RCC->AHB1ENR|=(1<<4))
#define GPIOH_PCLK_EN()        (RCC->AHB1ENR|=(1<<7))

//Disable
#define GPIOA_PCLK_DI()        (RCC->AHB1ENR &=~(1<<0))
#define GPIOB_PCLK_DI()        (RCC->AHB1ENR &=~(1<<1))
#define GPIOC_PCLK_DI()        (RCC->AHB1ENR &=~(1<<2))
#define GPIOD_PCLK_DI()        (RCC->AHB1ENR &=~(1<<3))
#define GPIOE_PCLK_DI()        (RCC->AHB1ENR &=~(1<<4))
#define GPIOH_PCLK_DI()        (RCC->AHB1ENR &=~(1<<7))

//Peripheral Clock enable and Disable macros IN I2C
#define I2C1_PCLK_EN()        (RCC->APB1ENR|=(1<<21))
#define I2C2_PCLK_EN()        (RCC->APB1ENR|=(1<<22))
#define I2C3_PCLK_EN()        (RCC->APB1ENR|=(1<<23))


//Disable
#define I2C1_PCLK_DI()        (RCC->APB1ENR &=~(1<<21))
#define I2C2_PCLK_DI()        (RCC->APB1ENR &=~(1<<22))
#define I2C3_PCLK_DI()        (RCC->APB1ENR &=~(1<<23))

//Peripheral Clock enable and Disable macros IN USART
#define USART1_PCLK_EN()        (RCC->APB2ENR|=(1<<4))
#define USART2_PCLK_EN()        (RCC->APB1ENR|=(1<<17))
#define USART6_PCLK_EN()        (RCC->APB2ENR|=(1<<5))


//Disable
#define USART1_PCLK_DI()        (RCC->APB2ENR &=~(1<<4))
#define USART2_PCLK_DI()        (RCC->APB1ENR &=~(1<<17))
#define USART6_PCLK_DI()        (RCC->APB2ENR &=~(1<<5))

//Clock enable and Disable macros IN SPI
#define SPI1_PCLK_EN()          (RCC->APB2ENR|=(1<<12))
#define SPI2_I2S2_PCLK_EN()     (RCC->APB1ENR|=(1<<14))
#define SPI3_I2S3_PCLK_EN()     (RCC->APB1ENR|=(1<<15))
#define SPI4_PCLK_EN()          (RCC->APB2ENR|=(1<<13))

//Disable
#define SPI1_PCLK_DI()          (RCC->APB2ENR &=~(1<<12))
#define SPI2_I2S2_PCLK_DI()     (RCC->APB1ENR &=~(1<<14))
#define SPI3_I2S3_PCLK_DI()     (RCC->APB1ENR &=~(1<<15))
#define SPI4_PCLK_DI()          (RCC->APB2ENR &=~(1<<13))

#define ENABLE                   1
#define DISABLE                  0


#endif /* INC_STM32F401XX_H_ */
